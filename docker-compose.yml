services:
  app:
    build: .
    ports:
      - "${PORT:-8000}:8000"
    volumes:
      - ./data:/data
      - ./config:/app/config:ro
    environment:
      # === Data & Storage ===
      - GRAPH_FILE=/data/graph.json
      - EMBEDDINGS_FILE=${EMBEDDINGS_FILE:-}
      - SCHEMA_FILE=/app/config/schema_config.json

      # === LLM Provider ===
      # Set LLM_PROVIDER to "claude" or "openai"
      - LLM_PROVIDER=${LLM_PROVIDER:-claude}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - OPENAI_MODEL=${OPENAI_MODEL:-gpt-4o}

      # === Authentication ===
      # Set AUTH_ENABLED=true and AUTH_PASSWORD=... if using Basic Auth
      - AUTH_ENABLED=${AUTH_ENABLED:-false}
      - AUTH_USERNAME=${AUTH_USERNAME:-admin}
      - AUTH_PASSWORD=${AUTH_PASSWORD:-}

      # === Server ===
      - HOST=0.0.0.0
      - PORT=8000
      - API_PREFIX=${API_PREFIX:-/api}
      - MCP_NAME=${MCP_NAME:-community-knowledge-graph}

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

    restart: unless-stopped
